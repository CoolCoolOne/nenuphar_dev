<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nenuphar_dev</title>
</head>

<body>

    <!-- первый блок в сайте -->
    <!-- рамочка и фон её -->
    <style>
        .chartBox {
            /* width: 100px; */
            padding: 20px;
            border-radius: 20px;
            border: solid 5px rgb(27, 129, 43);
            /*background: rgb(177, 204, 230);*/
        }
    </style>

    <!-- // выделяем место под диаграмму -->
    <div class="chartBox">
        <canvas id="SunChart_desktop"></canvas>
    </div>

    <!-- // добавляем библиотеку которая предлагает разные виды диаграмм -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- данные ссылки и количество!!! -->
    <script>
        const data = {
            labels: [
                'Вакансии',
                'Афиша',
                'Ищу соседа'
            ],
            datasets: [{
                label: ' ',
                data: [
                    { tag: 'Вакансии', url: 'https://github.com/CoolCoolOne', amount: { persent: 50 } },
                    { tag: 'Афиша', url: 'https://we-are-talking.bandcamp.com/', amount: { persent: 20 } },
                    { tag: 'Ищу соседа', url: 'https://www.youtube.com/channel/UCkSAiLDUNNzD0ub4frKriEQ', amount: { persent: 30 } }],
                backgroundColor: [
                    'rgb(50, 205, 50)',
                    'rgb(0, 255, 0)',
                    'rgb(144, 238, 144)'
                ],
                hoverOffset: 10
            }]
        };
        // легенда и конфиги
        const MainConfig = {
            type: 'pie',
            data,
            options: {
                parsing: {
                    key: 'amount.persent'
                },
                plugins: {
                    legend: {
                        display: false,
                    }
                }
            }
        };

        // код для работы интерактива
        const ctx = document.getElementById('SunChart_desktop');
        const DeskChart = new Chart(ctx, MainConfig);

        function pieLink(click) {
            const clickedInfo = DeskChart.getElementsAtEventForMode(click, 'nearest', { intersect: true }, true);
            if (clickedInfo.length) {
                const pieSlice = clickedInfo[0];
                const urlLink = (DeskChart.data.datasets[pieSlice.datasetIndex].data[pieSlice.index].url);
                console.log(urlLink);
                // location.href = urlLink;
                window.open(urlLink);
            }
        }
        ctx.onclick = pieLink;
    </script>
    <!-- конец первый блок в сайте -->


    <!-- Мобильный второй блок в сайте -->
    <!-- рамочка и фон её -->
    <style>
        .chartBox_m {
            /*max-width: 150px;*/
            padding: 15px;
            border-radius: 50%;
            border: solid 5px rgb(27, 129, 43);
            /*background: rgb(177, 204, 230);*/
        }

        .chartCard_m {
            padding: 10px;
            /*width: 100vw;*/
            /*height: calc(50vh);*/
            /* background: rgba(54, 162, 235, 0.2); */
            /*display: flex;*/
            /*align-items: center;*/
            /*justify-content: center;*/
        }
    </style>

    <!-- // выделяем место под диаграмму -->
    <div class="chartCard_m">
        <div class="chartBox_m">
            <canvas id="SunChart_m"></canvas>
        </div>
    </div>

    <!-- // добавляем плагин для подписей слайсов для мобилки -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js"></script>

    <!--// код js-->
    <script>

        //  конфиги. легенда определена в первом блоке
        const MobilConfig = {
            type: 'pie',
            data,
            options: {
                parsing: {
                    key: 'amount.persent'
                },
                plugins: {
                    legend: {
                        display: false,
                    },
                    datalabels: {
                        formatter: ((context, args) => {
                            const slIndex = args.dataIndex;
                            return args.dataset.data[slIndex].tag;
                        })
                    }
                }
            },
            plugins: [ChartDataLabels]
        };

        // MIBIL CONFIG !!!!! ctx M !!!!
        const ctx_m = document.getElementById('SunChart_m');
        const MobilChart = new Chart(ctx_m, MobilConfig);


        // реализация интерактива
        function pieLink_m(click) {
            const clickedInfo = MobilChart.getElementsAtEventForMode(click, 'nearest', { intersect: true }, true);
            if (clickedInfo.length) {
                const pieSlice = clickedInfo[0];
                const urlLink = (MobilChart.data.datasets[pieSlice.datasetIndex].data[pieSlice.index].url);
                // console.log(urlLink);
                location.href = urlLink;
                // window.open(urlLink);
            }
        }
        ctx_m.onclick = pieLink_m;


    </script>

    <!-- конец Мобильный второй блок в  сайте -->


</body>

</html>